"""
Proteins - 3D Protein Backbone Visualization
=============================================
Rotating 3D ribbon-style backbone traces of protein structures.
Color-coded by secondary structure: helix (red), sheet (yellow), coil (gray).
Real Cα coordinates from RCSB Protein Data Bank.

Controls:
  Joystick   - Rotate protein in 3D (pauses auto-cycle to let you explore)
  Z/X        - Cycle through proteins (resumes auto-cycle)

Auto-rotates around Z-axis. Manual rotation pauses cycling until you move on.
"""

import math
import random
from . import Visual, Display, Colors, GRID_SIZE


# Secondary structure colors (classic ribbon diagram scheme)
SS_COLORS = {
    'H': (255, 80, 80),    # Alpha helix - red/salmon
    'G': (255, 120, 100),  # 3-10 helix - lighter red
    'I': (255, 60, 120),   # Pi helix - pink-red
    'E': (255, 255, 80),   # Beta sheet - yellow
    'B': (220, 200, 80),   # Beta bridge - darker yellow
    'T': (100, 200, 180),  # Turn - cyan
    'S': (140, 140, 140),  # Bend - gray
    'C': (180, 180, 180),  # Coil/loop - light gray
}

# =============================================================================
# PROTEIN DATA - Real Cα coordinates from RCSB Protein Data Bank
# Generated with tools/pdb_parser.py
# =============================================================================

# Ubiquitin (PDB: 1UBQ) - 76 residues
# The "kiss of death" protein - tags proteins for destruction
# Nobel Prize connection: Ubiquitin system, 2004
UBIQUITIN = {
    'name': 'UBIQUITIN',
    'pdb': '1UBQ',
    'description': 'Protein degradation tag',
    'residues': 76,
    'categories': ['enzymes', 'ancient', 'nobel'],
    'backbone': [
        ( 26.266,  25.413,   2.842, 'E'),  # MET 1
        ( 26.850,  29.021,   3.898, 'E'),  # GLN 2
        ( 26.235,  30.058,   7.497, 'E'),  # ILE 3
        ( 26.772,  33.436,   9.197, 'E'),  # PHE 4
        ( 28.605,  33.965,  12.503, 'E'),  # VAL 5
        ( 27.691,  37.315,  14.143, 'E'),  # LYS 6
        ( 30.225,  38.643,  16.662, 'E'),  # THR 7
        ( 29.607,  41.180,  19.467, 'C'),  # LEU 8
        ( 31.422,  43.940,  17.553, 'C'),  # THR 9
        ( 28.978,  43.960,  14.678, 'E'),  # GLY 10
        ( 31.191,  42.012,  12.331, 'E'),  # LYS 11
        ( 29.542,  39.020,  10.653, 'E'),  # THR 12
        ( 31.720,  36.289,   9.176, 'E'),  # ILE 13
        ( 30.505,  33.884,   6.512, 'E'),  # THR 14
        ( 31.677,  30.275,   6.639, 'E'),  # LEU 15
        ( 31.220,  27.341,   4.275, 'E'),  # GLU 16
        ( 30.288,  24.245,   6.193, 'E'),  # VAL 17
        ( 28.468,  20.940,   5.980, 'C'),  # GLU 18
        ( 25.829,  19.825,   8.494, 'C'),  # PRO 19
        ( 28.054,  16.835,   9.210, 'C'),  # SER 20
        ( 30.796,  19.083,  10.566, 'C'),  # ASP 21
        ( 31.398,  19.064,  14.286, 'C'),  # THR 22
        ( 31.288,  22.201,  16.417, 'H'),  # ILE 23
        ( 35.031,  21.722,  17.069, 'H'),  # GLU 24
        ( 35.590,  21.945,  13.302, 'H'),  # ASN 25
        ( 33.533,  25.097,  12.978, 'H'),  # VAL 26
        ( 35.596,  26.715,  15.736, 'H'),  # LYS 27
        ( 38.794,  25.761,  13.880, 'H'),  # ALA 28
        ( 37.471,  27.391,  10.668, 'H'),  # LYS 29
        ( 36.731,  30.570,  12.645, 'H'),  # ILE 30
        ( 40.269,  30.508,  14.115, 'H'),  # GLN 31
        ( 41.718,  30.022,  10.643, 'H'),  # ASP 32
        ( 39.808,  32.994,   9.233, 'H'),  # LYS 33
        ( 39.676,  35.547,  12.072, 'H'),  # GLU 34
        ( 42.345,  34.269,  14.431, 'C'),  # GLY 35
        ( 40.226,  33.716,  17.509, 'C'),  # ILE 36
        ( 41.461,  30.751,  19.594, 'C'),  # PRO 37
        ( 38.817,  28.020,  19.889, 'C'),  # PRO 38
        ( 39.063,  28.063,  23.695, 'C'),  # ASP 39
        ( 37.738,  31.637,  23.712, 'E'),  # GLN 40
        ( 34.738,  30.875,  21.473, 'E'),  # GLN 41
        ( 31.200,  30.329,  22.780, 'E'),  # ARG 42
        ( 28.762,  29.573,  19.906, 'E'),  # LEU 43
        ( 25.034,  30.170,  20.401, 'E'),  # ILE 44
        ( 22.126,  29.062,  18.183, 'E'),  # PHE 45
        ( 18.443,  29.143,  19.083, 'C'),  # ALA 46
        ( 19.399,  29.894,  22.655, 'C'),  # GLY 47
        ( 21.550,  26.796,  23.133, 'E'),  # LYS 48
        ( 25.349,  26.872,  23.643, 'E'),  # GLN 49
        ( 26.826,  24.521,  21.012, 'E'),  # LEU 50
        ( 29.015,  21.657,  22.288, 'C'),  # GLU 51
        ( 32.262,  20.670,  20.514, 'C'),  # ASP 52
        ( 31.568,  16.962,  19.825, 'C'),  # GLY 53
        ( 28.108,  17.439,  18.276, 'C'),  # ARG 54
        ( 27.574,  18.192,  14.563, 'C'),  # THR 55
        ( 25.594,  21.109,  13.072, 'H'),  # LEU 56
        ( 22.924,  18.583,  12.025, 'H'),  # SER 57
        ( 22.418,  17.638,  15.693, 'H'),  # ASP 58
        ( 21.079,  21.149,  16.251, 'H'),  # TYR 59
        ( 19.065,  21.352,  12.999, 'C'),  # ASN 60
        ( 21.184,  24.263,  11.690, 'C'),  # ILE 61
        ( 20.081,  24.773,   8.033, 'C'),  # GLN 62
        ( 21.656,  26.847,   5.240, 'C'),  # LYS 63
        ( 21.907,  30.563,   5.881, 'E'),  # GLU 64
        ( 21.419,  30.253,   9.620, 'E'),  # SER 65
        ( 23.212,  32.762,  11.891, 'E'),  # THR 66
        ( 25.149,  31.609,  14.980, 'E'),  # LEU 67
        ( 26.179,  34.127,  17.650, 'E'),  # HIS 68
        ( 29.801,  34.145,  18.829, 'E'),  # LEU 69
        ( 30.479,  35.369,  22.374, 'E'),  # VAL 70
        ( 34.145,  35.472,  23.481, 'E'),  # LEU 71
        ( 35.161,  34.174,  26.896, 'E'),  # ARG 72
        ( 38.668,  35.502,  27.680, 'C'),  # LEU 73
        ( 40.873,  33.802,  30.253, 'C'),  # ARG 74
        ( 41.845,  36.550,  32.686, 'C'),  # GLY 75
        ( 40.373,  39.813,  33.944, 'C'),  # GLY 76
    ],
}

# Myoglobin (PDB: 1MBO) - 153 residues
# First protein structure ever solved by X-ray crystallography!
# Nobel Prize: Kendrew & Perutz, 1962
MYOGLOBIN = {
    'name': 'MYOGLOBIN',
    'pdb': '1MBO',
    'description': 'Oxygen storage',
    'residues': 153,
    'categories': ['transport', 'nobel', 'ancient'],
    'backbone': [
        ( -3.778,  15.543,  15.643, 'C'),  # VAL 1
        ( -0.551,  13.989,  17.161, 'C'),  # LEU 2
        ( -1.334,  12.314,  20.516, 'H'),  # SER 3
        (  0.526,  13.372,  23.579, 'H'),  # GLU 4
        (  2.461,  10.011,  23.364, 'H'),  # GLY 5
        (  3.548,  10.856,  19.792, 'H'),  # GLU 6
        (  4.662,  14.314,  20.831, 'H'),  # TRP 7
        (  6.743,  12.849,  23.641, 'H'),  # GLN 8
        (  8.532,  10.568,  21.090, 'H'),  # LEU 9
        (  9.321,  13.599,  18.864, 'H'),  # VAL 10
        ( 10.569,  15.786,  21.658, 'H'),  # LEU 11
        ( 12.668,  13.098,  23.228, 'H'),  # HIS 12
        ( 14.655,  12.593,  20.062, 'H'),  # VAL 13
        ( 14.771,  16.373,  19.420, 'H'),  # TRP 14
        ( 16.402,  17.011,  22.885, 'H'),  # ALA 15
        ( 19.198,  14.695,  21.533, 'H'),  # LYS 16
        ( 19.396,  16.851,  18.368, 'H'),  # VAL 17
        ( 19.967,  19.798,  20.613, 'H'),  # GLU 18
        ( 23.159,  18.327,  22.057, 'C'),  # ALA 19
        ( 24.742,  18.968,  18.609, 'H'),  # ASP 20
        ( 22.609,  21.371,  16.567, 'H'),  # VAL 21
        ( 25.375,  22.419,  14.217, 'H'),  # ALA 22
        ( 26.538,  18.922,  13.278, 'H'),  # GLY 23
        ( 22.908,  17.835,  12.696, 'H'),  # HIS 24
        ( 22.291,  20.941,  10.601, 'H'),  # GLY 25
        ( 25.242,  20.209,   8.395, 'H'),  # GLN 26
        ( 24.485,  16.568,   7.799, 'H'),  # ASP 27
        ( 20.761,  17.483,   7.013, 'H'),  # ILE 28
        ( 21.684,  20.268,   4.480, 'H'),  # LEU 29
        ( 24.399,  18.138,   2.829, 'H'),  # ILE 30
        ( 22.016,  15.206,   2.455, 'H'),  # ARG 31
        ( 19.417,  17.536,   0.870, 'H'),  # LEU 32
        ( 21.897,  19.050,  -1.564, 'H'),  # PHE 33
        ( 23.432,  15.773,  -2.591, 'H'),  # LYS 34
        ( 20.115,  13.881,  -2.948, 'H'),  # SER 35
        ( 18.252,  16.814,  -4.658, 'H'),  # HIS 36
        ( 20.740,  19.059,  -6.403, 'H'),  # PRO 37
        ( 18.028,  21.416,  -7.582, 'H'),  # GLU 38
        ( 17.636,  22.578,  -3.958, 'H'),  # THR 39
        ( 21.136,  23.988,  -3.888, 'H'),  # LEU 40
        ( 20.362,  26.317,  -6.708, 'H'),  # GLU 41
        ( 17.817,  28.134,  -4.480, 'H'),  # LYS 42
        ( 20.737,  29.318,  -2.365, 'C'),  # PHE 43
        ( 22.813,  32.143,  -3.813, 'C'),  # ASP 44
        ( 24.831,  31.896,  -0.674, 'C'),  # ARG 45
        ( 25.788,  28.243,  -1.167, 'C'),  # PHE 46
        ( 25.616,  27.570,  -4.932, 'C'),  # LYS 47
        ( 29.386,  27.834,  -5.308, 'C'),  # HIS 48
        ( 29.912,  24.557,  -3.338, 'C'),  # LEU 49
        ( 30.347,  21.580,  -5.555, 'C'),  # LYS 50
        ( 31.767,  18.709,  -3.524, 'H'),  # THR 51
        ( 30.744,  17.144,  -0.264, 'H'),  # GLU 52
        ( 34.155,  18.102,   1.307, 'H'),  # ALA 53
        ( 33.641,  21.706,   0.251, 'H'),  # GLU 54
        ( 30.199,  21.618,   1.860, 'H'),  # MET 55
        ( 31.589,  20.175,   5.087, 'H'),  # LYS 56
        ( 34.314,  22.835,   5.280, 'H'),  # ALA 57
        ( 31.912,  25.807,   4.967, 'H'),  # SER 58
        ( 31.373,  27.614,   8.202, 'H'),  # GLU 59
        ( 28.550,  29.665,   6.679, 'H'),  # ASP 60
        ( 26.658,  26.500,   5.717, 'H'),  # LEU 61
        ( 26.994,  25.225,   9.258, 'H'),  # LYS 62
        ( 25.617,  28.558,  10.478, 'H'),  # LYS 63
        ( 22.528,  28.344,   8.261, 'H'),  # HIS 64
        ( 22.026,  24.725,   9.446, 'H'),  # GLY 65
        ( 21.740,  26.113,  12.986, 'H'),  # VAL 66
        ( 19.213,  28.787,  11.765, 'H'),  # THR 67
        ( 17.053,  26.058,  10.208, 'H'),  # VAL 68
        ( 17.122,  23.647,  13.156, 'H'),  # LEU 69
        ( 16.561,  26.401,  15.713, 'H'),  # THR 70
        ( 13.319,  27.524,  13.913, 'H'),  # ALA 71
        ( 12.223,  23.897,  13.490, 'H'),  # LEU 72
        ( 12.729,  23.180,  17.183, 'H'),  # GLY 73
        ( 10.726,  26.217,  18.228, 'H'),  # ALA 74
        (  7.837,  24.902,  16.083, 'H'),  # ILE 75
        (  8.025,  21.366,  17.417, 'H'),  # LEU 76
        (  7.932,  22.399,  21.075, 'H'),  # LYS 77
        (  4.605,  24.157,  20.444, 'C'),  # LYS 78
        (  3.055,  20.773,  19.885, 'C'),  # LYS 79
        (  0.884,  21.856,  16.914, 'C'),  # GLY 80
        (  0.084,  25.364,  18.327, 'C'),  # HIS 81
        (  2.580,  27.040,  15.977, 'C'),  # HIS 82
        (  0.499,  29.591,  14.125, 'C'),  # GLU 83
        (  2.743,  32.492,  15.046, 'C'),  # ALA 84
        (  6.006,  30.722,  14.276, 'C'),  # GLU 85
        (  4.845,  29.367,  10.944, 'H'),  # LEU 86
        (  3.418,  32.583,   9.510, 'H'),  # LYS 87
        (  6.733,  34.474,   8.914, 'H'),  # PRO 88
        (  8.392,  31.339,   7.647, 'H'),  # LEU 89
        (  5.743,  30.450,   5.036, 'H'),  # ALA 90
        (  5.641,  34.082,   3.996, 'H'),  # GLN 91
        (  9.397,  34.325,   3.212, 'H'),  # SER 92
        (  9.482,  30.829,   1.766, 'H'),  # HIS 93
        (  6.608,  31.444,  -0.570, 'H'),  # ALA 94
        (  7.318,  34.957,  -1.613, 'H'),  # THR 95
        ( 11.039,  35.730,  -1.078, 'C'),  # LYS 96
        ( 12.802,  32.390,  -1.408, 'C'),  # HIS 97
        ( 10.294,  30.627,  -3.632, 'C'),  # LYS 98
        ( 10.521,  27.177,  -2.140, 'C'),  # ILE 99
        (  8.107,  24.624,  -3.490, 'H'),  # PRO 100
        (  6.278,  22.523,  -0.982, 'H'),  # ILE 101
        (  7.913,  19.410,  -2.562, 'H'),  # LYS 102
        ( 11.348,  20.703,  -1.426, 'H'),  # TYR 103
        (  9.975,  20.841,   2.111, 'H'),  # LEU 104
        (  9.100,  17.159,   1.628, 'H'),  # GLU 105
        ( 12.731,  16.563,   0.592, 'H'),  # PHE 106
        ( 14.231,  18.277,   3.694, 'H'),  # ILE 107
        ( 11.737,  16.264,   5.770, 'H'),  # SER 108
        ( 13.167,  13.030,   4.370, 'H'),  # GLU 109
        ( 16.755,  14.307,   5.047, 'H'),  # ALA 110
        ( 15.883,  15.097,   8.723, 'H'),  # ILE 111
        ( 14.464,  11.614,   9.196, 'H'),  # ILE 112
        ( 17.445,   9.959,   7.522, 'H'),  # HIS 113
        ( 19.961,  11.825,   9.752, 'H'),  # VAL 114
        ( 18.023,  11.272,  12.956, 'H'),  # LEU 115
        ( 18.079,   7.530,  12.152, 'H'),  # HIS 116
        ( 21.797,   7.628,  11.492, 'H'),  # SER 117
        ( 22.653,   9.420,  14.723, 'H'),  # ARG 118
        ( 20.104,   8.133,  17.264, 'C'),  # HIS 119
        ( 18.995,   4.589,  16.396, 'C'),  # PRO 120
        ( 18.241,   3.607,  20.023, 'C'),  # GLY 121
        ( 15.778,   6.428,  20.440, 'C'),  # ASP 122
        ( 14.609,   6.460,  16.900, 'C'),  # PHE 123
        ( 12.832,   3.156,  16.524, 'H'),  # GLY 124
        (  9.786,   2.736,  14.225, 'H'),  # ALA 125
        (  7.389,   4.297,  16.637, 'H'),  # ASP 126
        (  9.515,   7.486,  16.976, 'H'),  # ALA 127
        ( 10.012,   7.522,  13.159, 'H'),  # GLN 128
        (  6.259,   7.374,  12.620, 'H'),  # GLY 129
        (  5.701,  10.186,  15.152, 'H'),  # ALA 130
        (  8.374,  12.432,  13.582, 'H'),  # MET 131
        (  6.970,  11.819,  10.125, 'H'),  # ASN 132
        (  3.551,  12.927,  11.442, 'H'),  # LYS 133
        (  4.933,  16.037,  12.959, 'H'),  # ALA 134
        (  6.744,  16.974,   9.736, 'H'),  # LEU 135
        (  3.556,  16.299,   7.737, 'H'),  # GLU 136
        (  1.634,  18.685,  10.046, 'H'),  # LEU 137
        (  4.324,  21.348,   9.443, 'H'),  # PHE 138
        (  3.960,  20.790,   5.668, 'H'),  # ARG 139
        (  0.178,  20.774,   5.660, 'H'),  # LYS 140
        ( -0.073,  24.051,   7.608, 'H'),  # ASP 141
        (  2.592,  25.760,   5.470, 'H'),  # ILE 142
        (  0.793,  24.452,   2.322, 'H'),  # ALA 143
        ( -2.403,  26.208,   3.476, 'H'),  # ALA 144
        ( -0.609,  29.511,   3.779, 'H'),  # LYS 145
        (  1.012,  29.107,   0.347, 'H'),  # TYR 146
        ( -2.467,  28.487,  -1.060, 'H'),  # LYS 147
        ( -3.764,  31.650,   0.411, 'H'),  # GLU 148
        ( -0.868,  33.677,  -1.039, 'H'),  # LEU 149
        ( -1.280,  31.951,  -4.500, 'C'),  # GLY 150
        (  1.969,  29.821,  -4.613, 'C'),  # TYR 151
        (  0.565,  26.440,  -3.380, 'C'),  # GLN 152
        (  3.821,  24.384,  -3.588, 'C'),  # GLY 153
    ],
}

# Lysozyme (PDB: 1LYZ) - 129 residues
# Antibacterial enzyme found in tears, saliva, and egg white
# First enzyme structure solved
LYSOZYME = {
    'name': 'LYSOZYME',
    'pdb': '1LYZ',
    'description': 'Antibacterial enzyme',
    'residues': 129,
    'categories': ['immune', 'enzymes', 'nobel'],
    'backbone': [
        (  2.439,  10.217,   9.791, 'E'),  # LYS 1
        (  2.307,  14.172,   7.580, 'E'),  # VAL 2
        ( -1.187,  15.293,   7.580, 'E'),  # PHE 3
        ( -2.637,  17.468,   4.864, 'C'),  # GLY 4
        ( -3.823,  20.764,   5.685, 'H'),  # ARG 5
        ( -7.581,  20.105,   4.611, 'H'),  # CYS 6
        ( -7.119,  16.414,   6.191, 'H'),  # GLU 7
        ( -5.735,  17.534,   9.475, 'H'),  # LEU 8
        ( -8.372,  19.907,   9.665, 'H'),  # ALA 9
        (-11.206,  17.205,   9.475, 'H'),  # ALA 10
        ( -9.426,  14.963,  11.749, 'H'),  # ALA 11
        ( -9.295,  17.534,  14.529, 'H'),  # MET 12
        (-12.854,  18.062,  14.213, 'H'),  # LYS 13
        (-13.645,  14.502,  14.213, 'H'),  # ARG 14
        (-11.865,  14.898,  17.814, 'H'),  # HIS 15
        (-13.645,  17.996,  19.772, 'C'),  # GLY 16
        (-10.877,  20.764,  18.635, 'C'),  # LEU 17
        (-13.184,  23.071,  16.866, 'C'),  # ASP 18
        (-14.172,  25.708,  19.330, 'C'),  # ASN 19
        (-12.656,  24.258,  21.857, 'C'),  # TYR 20
        (-12.195,  26.697,  24.762, 'C'),  # ARG 21
        (-13.513,  29.136,  22.109, 'C'),  # GLY 22
        (-10.086,  28.609,  19.646, 'C'),  # TYR 23
        (-11.338,  28.147,  16.171, 'C'),  # SER 24
        (-10.547,  25.379,  13.897, 'H'),  # LEU 25
        ( -8.174,  27.224,  12.002, 'H'),  # GLY 26
        ( -6.262,  28.279,  15.161, 'H'),  # ASN 27
        ( -5.603,  24.588,  15.540, 'H'),  # TRP 28
        ( -4.614,  23.731,  11.876, 'H'),  # VAL 29
        ( -2.109,  26.697,  11.560, 'H'),  # CYS 30
        ( -0.791,  25.840,  14.718, 'H'),  # ALA 31
        ( -0.198,  22.478,  14.592, 'H'),  # ALA 32
        (  1.384,  23.467,  10.612, 'H'),  # LYS 33
        (  3.955,  25.906,  11.749, 'H'),  # PHE 34
        (  4.680,  23.796,  14.971, 'H'),  # GLU 35
        (  4.878,  20.435,  13.455, 'C'),  # SER 36
        (  4.680,  20.632,   9.665, 'C'),  # ASN 37
        (  1.780,  18.062,   9.475, 'E'),  # PHE 38
        (  4.021,  15.754,  10.676, 'E'),  # ASN 39
        (  2.966,  13.843,  13.771, 'E'),  # THR 40
        (  6.724,  12.063,  14.339, 'C'),  # GLN 41
        (  8.569,  15.293,  14.339, 'E'),  # ALA 42
        ( 10.481,  15.623,  17.751, 'E'),  # THR 43
        ( 12.195,  18.787,  19.077, 'E'),  # ASN 44
        ( 14.766,  19.248,  21.857, 'E'),  # ARG 45
        ( 15.161,  22.676,  23.499, 'E'),  # ASN 46
        ( 18.589,  23.071,  26.026, 'C'),  # THR 47
        ( 17.007,  21.819,  29.500, 'C'),  # ASP 48
        ( 16.480,  17.930,  28.805, 'C'),  # GLY 49
        ( 13.184,  18.787,  27.605, 'E'),  # SER 50
        ( 11.931,  17.798,  24.257, 'E'),  # THR 51
        (  8.899,  18.457,  22.109, 'E'),  # ASP 52
        (  6.987,  15.623,  20.277, 'E'),  # TYR 53
        (  4.087,  15.161,  17.687, 'E'),  # GLY 54
        (  1.846,  17.600,  15.413, 'C'),  # ILE 55
        (  1.187,  19.775,  18.319, 'C'),  # LEU 56
        (  4.746,  19.907,  20.025, 'E'),  # GLN 57
        (  3.889,  18.853,  23.373, 'E'),  # ILE 58
        (  6.724,  19.248,  25.899, 'E'),  # ASN 59
        (  8.042,  16.611,  28.426, 'E'),  # SER 60
        (  8.701,  18.655,  31.332, 'C'),  # ARG 61
        (  4.812,  18.787,  32.090, 'C'),  # TRP 62
        (  2.703,  16.875,  29.563, 'C'),  # TRP 63
        (  4.153,  13.579,  28.805, 'C'),  # CYS 64
        (  6.921,  11.470,  30.195, 'C'),  # ASN 65
        (  9.954,  10.151,  27.858, 'C'),  # ASP 66
        ( 12.195,   8.833,  30.321, 'C'),  # GLY 67
        ( 15.029,  11.404,  30.005, 'C'),  # ARG 68
        ( 13.843,  14.700,  31.079, 'C'),  # THR 69
        ( 14.172,  14.832,  34.869, 'C'),  # PRO 70
        ( 11.865,  17.666,  35.754, 'C'),  # GLY 71
        (  9.229,  15.623,  34.806, 'C'),  # SER 72
        (  5.867,  15.689,  36.259, 'C'),  # ARG 73
        (  3.757,  13.711,  33.985, 'C'),  # ASN 74
        (  0.725,  16.018,  33.732, 'C'),  # LEU 75
        ( -1.187,  14.107,  30.700, 'C'),  # CYS 76
        ( -0.066,  10.942,  32.280, 'C'),  # ASN 77
        (  0.791,   9.492,  28.679, 'C'),  # ILE 78
        (  4.614,   8.569,  27.542, 'C'),  # PRO 79
        (  5.933,  11.206,  24.762, 'H'),  # CYS 80
        (  5.999,   8.635,  22.299, 'H'),  # SER 81
        (  2.307,   8.108,  22.236, 'H'),  # ALA 82
        (  2.439,  11.536,  20.846, 'H'),  # LEU 83
        (  4.021,  10.679,  17.624, 'H'),  # LEU 84
        (  1.846,   7.910,  16.361, 'C'),  # SER 85
        ( -0.264,   8.503,  13.329, 'C'),  # SER 86
        ( -3.428,   8.899,  15.413, 'C'),  # ASP 87
        ( -3.823,  12.261,  17.182, 'C'),  # ILE 88
        ( -5.933,  11.008,  19.961, 'H'),  # THR 89
        ( -3.230,  11.668,  22.425, 'H'),  # ALA 90
        ( -2.175,  14.766,  21.478, 'H'),  # SER 91
        ( -5.339,  16.348,  20.909, 'H'),  # VAL 92
        ( -6.658,  14.766,  24.257, 'H'),  # ASN 93
        ( -3.362,  16.084,  25.836, 'H'),  # CYS 94
        ( -3.691,  19.446,  23.941, 'H'),  # ALA 95
        ( -7.053,  19.710,  25.647, 'H'),  # LYS 96
        ( -5.273,  20.303,  29.247, 'C'),  # LYS 97
        ( -2.835,  22.742,  27.921, 'C'),  # ILE 98
        ( -5.076,  24.851,  26.278, 'C'),  # VAL 99
        ( -7.581,  24.851,  29.563, 'C'),  # SER 100
        ( -4.944,  25.313,  32.153, 'C'),  # ASP 101
        ( -4.482,  29.004,  31.774, 'C'),  # GLY 102
        ( -2.769,  30.454,  28.679, 'C'),  # ASN 103
        ( -4.614,  29.334,  25.899, 'C'),  # GLY 104
        ( -2.966,  28.674,  22.741, 'C'),  # MET 105
        ( -0.198,  31.311,  24.004, 'C'),  # ASN 106
        (  1.318,  28.213,  25.647, 'C'),  # ALA 107
        (  2.373,  27.554,  22.109, 'C'),  # TRP 108
        (  5.273,  29.861,  21.288, 'C'),  # VAL 109
        (  4.482,  29.466,  17.435, 'C'),  # ALA 110
        (  0.461,  30.322,  17.182, 'C'),  # TRP 111
        (  1.318,  33.289,  19.203, 'C'),  # ARG 112
        (  4.219,  34.673,  16.993, 'C'),  # ASN 113
        (  2.769,  33.355,  13.455, 'C'),  # ARG 114
        ( -1.121,  32.564,  13.771, 'C'),  # CYS 115
        ( -2.373,  34.937,  16.677, 'C'),  # LYS 116
        ( -4.153,  37.639,  15.224, 'C'),  # GLY 117
        ( -4.087,  36.519,  11.370, 'C'),  # THR 118
        ( -7.185,  35.200,   9.475, 'C'),  # ASP 119
        ( -6.592,  31.311,  10.676, 'C'),  # VAL 120
        ( -9.954,  30.520,   8.591, 'C'),  # GLN 121
        ( -7.844,  30.652,   5.306, 'C'),  # ALA 122
        ( -6.262,  27.290,   6.759, 'C'),  # TRP 123
        ( -9.756,  25.576,   6.570, 'C'),  # ILE 124
        (-10.877,  27.026,   3.411, 'C'),  # ARG 125
        (-11.602,  24.588,   0.695, 'C'),  # GLY 126
        (-12.327,  21.951,   3.411, 'C'),  # CYS 127
        (-15.359,  19.710,   3.601, 'C'),  # ARG 128
        (-15.952,  19.907,   7.264, 'C'),  # LEU 129
    ],
}

# Insulin A-chain (PDB: 4INS) - 21 residues
# Blood sugar regulation - first protein sequenced (Sanger, Nobel 1958)
# First recombinant protein drug (1982)
INSULIN = {
    'name': 'INSULIN',
    'pdb': '4INS',
    'description': 'Blood sugar hormone',
    'residues': 21,
    'categories': ['signaling', 'disease', 'nobel'],
    'backbone': [
        ( -9.929,  17.026,  13.244, 'H'),  # GLY 1
        (-10.488,  14.266,  10.600, 'H'),  # ILE 2
        ( -6.966,  12.901,  10.576, 'H'),  # VAL 3
        ( -6.889,  12.474,  14.295, 'H'),  # GLU 4
        (-10.407,  11.299,  14.630, 'H'),  # GLN 5
        (-10.050,   8.518,  12.065, 'H'),  # CYS 6
        ( -6.964,   7.186,  13.808, 'H'),  # CYS 7
        ( -7.862,   7.732,  17.520, 'H'),  # THR 8
        (-11.509,   6.803,  17.121, 'H'),  # SER 9
        (-13.350,   5.723,  13.932, 'H'),  # ILE 10
        (-14.665,   7.679,  10.880, 'C'),  # CYS 11
        (-16.999,   6.978,   8.005, 'H'),  # SER 12
        (-16.530,   7.444,   4.259, 'H'),  # LEU 13
        (-19.282,  10.035,   4.368, 'H'),  # TYR 14
        (-17.178,  12.138,   6.774, 'H'),  # GLN 15
        (-14.185,  11.826,   4.470, 'H'),  # LEU 16
        (-16.223,  13.179,   1.589, 'H'),  # GLU 17
        (-16.029,  16.534,   3.332, 'C'),  # ASN 18
        (-12.358,  16.724,   2.380, 'C'),  # TYR 19
        (-12.838,  16.309,  -1.389, 'C'),  # CYS 20
        (-12.404,  19.399,  -3.608, 'C'),  # ASN 21
    ],
}

# Green Fluorescent Protein (PDB: 1GFL) - 230 residues
# Glowing protein from jellyfish - revolutionized cell biology
# Nobel Prize: Shimomura, Chalfie, Tsien, 2008
GFP = {
    'name': 'GFP',
    'pdb': '1GFL',
    'description': 'Glowing jellyfish tag',
    'residues': 230,
    'categories': ['fluorescent', 'nobel', 'tools'],
    'backbone': [
        (-14.989,  61.651,  -8.981, 'C'),  # ALA 1
        (-13.364,  63.821, -11.651, 'C'),  # SER 2
        (-11.712,  62.828, -14.936, 'C'),  # LYS 3
        ( -7.907,  62.824, -15.260, 'C'),  # GLY 4
        ( -7.546,  61.431, -11.779, 'H'),  # GLU 5
        ( -7.990,  57.947, -13.219, 'H'),  # GLU 6
        ( -4.656,  58.206, -15.052, 'H'),  # LEU 7
        ( -2.954,  58.395, -11.672, 'H'),  # PHE 8
        ( -4.428,  55.542,  -9.683, 'C'),  # THR 9
        ( -1.363,  53.289, -10.077, 'C'),  # GLY 10
        (  2.383,  53.838, -10.258, 'E'),  # VAL 11
        (  3.190,  55.922, -13.361, 'E'),  # VAL 12
        (  6.574,  55.912, -15.265, 'E'),  # PRO 13
        (  8.240,  59.331, -15.585, 'E'),  # ILE 14
        ( 10.600,  60.647, -18.221, 'E'),  # LEU 15
        ( 12.458,  63.889, -17.680, 'E'),  # VAL 16
        ( 14.566,  65.713, -20.284, 'E'),  # GLU 17
        ( 16.312,  68.993, -19.861, 'E'),  # LEU 18
        ( 18.412,  71.124, -22.149, 'E'),  # ASP 19
        ( 20.022,  74.039, -20.500, 'E'),  # GLY 20
        ( 22.424,  76.860, -20.930, 'E'),  # ASP 21
        ( 23.717,  78.814, -17.953, 'E'),  # VAL 22
        ( 25.982,  81.777, -18.723, 'C'),  # ASN 23
        ( 26.765,  80.029, -22.038, 'C'),  # GLY 24
        ( 27.607,  76.658, -20.450, 'E'),  # HIS 25
        ( 25.426,  74.094, -22.141, 'E'),  # LYS 26
        ( 24.405,  70.732, -20.713, 'E'),  # PHE 27
        ( 21.680,  68.141, -20.900, 'E'),  # SER 28
        ( 20.241,  65.807, -18.338, 'E'),  # VAL 29
        ( 17.870,  62.880, -18.678, 'E'),  # SER 30
        ( 15.958,  61.347, -15.782, 'E'),  # GLY 31
        ( 13.583,  58.464, -15.195, 'E'),  # GLU 32
        ( 11.553,  57.198, -12.260, 'E'),  # GLU 33
        (  8.018,  56.672, -11.033, 'E'),  # GLU 34
        (  5.289,  58.578,  -9.380, 'E'),  # GLY 35
        (  2.600,  57.422,  -7.007, 'E'),  # ASP 36
        ( -0.021,  60.085,  -6.508, 'C'),  # ALA 37
        ( -2.006,  57.916,  -4.092, 'C'),  # THR 38
        (  0.868,  58.212,  -1.667, 'C'),  # TYR 39
        (  2.044,  61.547,  -2.960, 'C'),  # GLY 40
        (  5.458,  60.208,  -3.770, 'E'),  # LYS 41
        (  8.126,  60.413,  -6.489, 'E'),  # LEU 42
        ( 11.401,  58.581,  -7.031, 'E'),  # THR 43
        ( 13.677,  59.931,  -9.793, 'E'),  # LEU 44
        ( 17.229,  59.435, -10.989, 'E'),  # LYS 45
        ( 18.935,  62.079, -13.193, 'E'),  # PHE 46
        ( 22.102,  61.660, -15.310, 'E'),  # ILE 47
        ( 24.084,  64.503, -16.937, 'E'),  # CYS 48
        ( 24.473,  63.203, -20.472, 'C'),  # THR 49
        ( 27.003,  65.883, -21.454, 'C'),  # THR 50
        ( 29.676,  65.353, -18.848, 'C'),  # GLY 51
        ( 29.720,  66.987, -15.424, 'C'),  # LYS 52
        ( 26.854,  69.274, -14.515, 'C'),  # LEU 53
        ( 28.166,  72.829, -14.590, 'C'),  # PRO 54
        ( 25.782,  74.010, -11.817, 'C'),  # VAL 55
        ( 24.985,  72.411,  -8.397, 'C'),  # PRO 56
        ( 22.405,  69.600,  -8.568, 'H'),  # TRP 57
        ( 20.197,  71.142,  -5.873, 'H'),  # PRO 58
        ( 19.491,  74.253,  -8.057, 'H'),  # THR 59
        ( 17.582,  72.096, -10.581, 'H'),  # LEU 60
        ( 15.343,  70.085,  -8.219, 'H'),  # VAL 61
        ( 12.225,  72.264,  -8.643, 'H'),  # THR 62
        ( 12.771,  72.299, -12.423, 'H'),  # THR 63
        ( 12.963,  68.520, -12.736, 'H'),  # PHE 64
        ( 10.237,  67.920, -10.172, 'C'),  # SER 65
        (  8.729,  70.767,  -8.479, 'C'),  # TYR 66
        (  8.418,  69.770, -11.975, 'C'),  # GLY 67
        (  5.756,  67.061, -11.927, 'C'),  # VAL 68
        (  3.291,  68.265,  -9.299, 'H'),  # GLN 69
        (  0.540,  66.152, -10.828, 'H'),  # CYS 70
        (  1.884,  63.445,  -8.508, 'H'),  # PHE 71
        (  0.756,  65.440,  -5.427, 'C'),  # SER 72
        ( -1.572,  63.626,  -3.086, 'C'),  # ARG 73
        ( -4.812,  65.638,  -2.824, 'C'),  # TYR 74
        ( -6.965,  64.648,   0.177, 'C'),  # PRO 75
        (-10.489,  63.603,  -0.855, 'H'),  # ASP 76
        (-12.027,  66.840,   0.313, 'H'),  # HIS 77
        ( -9.823,  68.949,  -1.931, 'H'),  # MET 78
        ( -9.790,  66.826,  -5.079, 'H'),  # LYS 79
        (-11.966,  69.496,  -6.709, 'H'),  # ARG 80
        ( -8.886,  71.743,  -6.596, 'H'),  # HIS 81
        ( -6.419,  69.504,  -8.438, 'C'),  # ASP 82
        ( -5.583,  71.548, -11.559, 'H'),  # PHE 83
        ( -2.587,  69.365, -12.348, 'H'),  # PHE 84
        ( -4.405,  66.057, -12.918, 'H'),  # LYS 85
        ( -7.371,  67.780, -14.594, 'H'),  # SER 86
        ( -5.137,  68.934, -17.452, 'C'),  # ALA 87
        ( -4.156,  65.365, -18.321, 'C'),  # MET 88
        ( -3.572,  63.548, -20.703, 'C'),  # PRO 89
        ( -2.989,  66.616, -22.868, 'C'),  # GLU 90
        ( -0.871,  68.217, -20.203, 'C'),  # GLY 91
        (  0.158,  71.697, -19.235, 'E'),  # TYR 92
        (  2.937,  74.153, -19.895, 'E'),  # VAL 93
        (  4.889,  75.127, -16.828, 'E'),  # GLN 94
        (  6.945,  78.316, -16.944, 'E'),  # GLU 95
        (  9.138,  79.884, -14.271, 'E'),  # ARG 96
        ( 11.547,  82.605, -13.478, 'E'),  # THR 97
        ( 13.728,  81.648, -10.536, 'E'),  # ILE 98
        ( 15.638,  84.463,  -8.932, 'E'),  # PHE 99
        ( 18.707,  83.537,  -6.879, 'E'),  # PHE 100
        ( 19.199,  86.314,  -4.338, 'C'),  # LYS 101
        ( 22.325,  88.350,  -5.042, 'C'),  # ASP 102
        ( 22.911,  86.248,  -8.154, 'C'),  # ASP 103
        ( 21.502,  85.244, -11.554, 'C'),  # GLY 104
        ( 18.206,  83.761, -12.646, 'E'),  # ASN 105
        ( 16.836,  80.733, -14.443, 'E'),  # TYR 106
        ( 13.970,  81.012, -16.898, 'E'),  # LYS 107
        ( 12.380,  77.707, -17.760, 'E'),  # THR 108
        (  9.622,  76.389, -19.932, 'E'),  # ARG 109
        (  8.410,  72.881, -19.711, 'E'),  # ALA 110
        (  5.705,  70.670, -21.115, 'E'),  # GLU 111
        (  4.255,  68.006, -18.881, 'E'),  # VAL 112
        (  2.022,  65.504, -20.643, 'E'),  # LYS 113
        (  1.325,  61.823, -21.267, 'E'),  # PHE 114
        (  3.191,  60.302, -24.163, 'E'),  # GLU 115
        (  1.722,  56.827, -24.305, 'C'),  # GLY 116
        (  1.854,  55.310, -20.831, 'C'),  # ASP 117
        (  4.539,  57.530, -19.307, 'E'),  # THR 118
        (  4.378,  61.017, -17.938, 'E'),  # LEU 119
        (  7.099,  63.118, -19.514, 'E'),  # VAL 120
        (  8.533,  66.445, -18.494, 'E'),  # ASN 121
        ( 10.513,  68.194, -21.250, 'E'),  # ARG 122
        ( 12.305,  71.352, -20.183, 'E'),  # ILE 123
        ( 14.247,  74.230, -21.565, 'E'),  # GLU 124
        ( 16.320,  76.314, -19.217, 'E'),  # LEU 125
        ( 18.324,  79.485, -19.681, 'E'),  # LYS 126
        ( 20.300,  81.011, -16.858, 'E'),  # GLY 127
        ( 22.098,  84.289, -16.889, 'E'),  # ILE 128
        ( 23.719,  86.905, -14.690, 'C'),  # ASP 129
        ( 25.495,  84.336, -12.563, 'C'),  # PHE 130
        ( 28.659,  85.351, -10.736, 'C'),  # LYS 131
        ( 31.657,  83.046, -11.338, 'C'),  # GLU 132
        ( 32.417,  83.453,  -7.634, 'C'),  # ASP 133
        ( 28.821,  83.192,  -6.459, 'C'),  # GLY 134
        ( 27.204,  80.384,  -4.496, 'C'),  # ASN 135
        ( 25.938,  78.790,  -7.705, 'C'),  # ILE 136
        ( 28.840,  78.937, -10.190, 'C'),  # LEU 137
        ( 31.122,  78.576,  -7.210, 'C'),  # GLY 138
        ( 29.402,  75.300,  -6.175, 'C'),  # HIS 139
        ( 29.075,  76.236,  -2.493, 'C'),  # LYS 140
        ( 25.670,  74.594,  -1.999, 'C'),  # LEU 141
        ( 25.352,  71.566,   0.257, 'C'),  # GLU 142
        ( 24.004,  68.468,  -1.438, 'C'),  # TYR 143
        ( 20.706,  68.301,   0.477, 'C'),  # ASN 144
        ( 17.204,  69.798,   0.515, 'C'),  # TYR 145
        ( 14.626,  71.329,   2.965, 'C'),  # ASN 146
        ( 10.839,  71.326,   3.256, 'C'),  # SER 147
        (  8.821,  74.025,   1.534, 'E'),  # HIS 148
        (  5.247,  75.054,   1.019, 'E'),  # ASN 149
        (  4.182,  75.904,  -2.518, 'E'),  # VAL 150
        (  1.320,  78.393,  -2.780, 'E'),  # TYR 151
        ( -1.273,  78.033,  -5.533, 'E'),  # ILE 152
        ( -3.952,  80.373,  -6.789, 'E'),  # MET 153
        ( -6.148,  80.242,  -9.851, 'E'),  # ALA 154
        ( -5.538,  82.624, -12.743, 'E'),  # ASP 155
        ( -9.069,  82.807, -14.193, 'H'),  # LYS 156
        ( -7.862,  84.998, -17.053, 'H'),  # GLN 157
        ( -5.338,  82.435, -18.346, 'H'),  # LYS 158
        ( -7.450,  79.367, -17.478, 'C'),  # ASN 159
        ( -4.503,  78.254, -15.336, 'E'),  # GLY 160
        ( -2.777,  78.786, -12.000, 'E'),  # ILE 161
        ( -0.025,  81.009, -10.589, 'E'),  # LYS 162
        (  2.387,  79.502,  -8.093, 'E'),  # VAL 163
        (  4.875,  81.236,  -5.759, 'E'),  # ASN 164
        (  7.399,  79.985,  -3.217, 'E'),  # PHE 165
        ( 10.951,  80.581,  -1.951, 'E'),  # LYS 166
        ( 13.466,  77.738,  -1.743, 'E'),  # ILE 167
        ( 16.113,  77.855,   0.993, 'E'),  # ARG 168
        ( 19.329,  76.182,  -0.135, 'E'),  # HIS 169
        ( 21.909,  75.519,   2.558, 'E'),  # ASN 170
        ( 25.343,  76.873,   1.829, 'C'),  # ILE 171
        ( 28.315,  74.950,   3.002, 'C'),  # GLU 172
        ( 29.370,  77.788,   5.317, 'C'),  # ASP 173
        ( 26.116,  77.826,   7.290, 'C'),  # GLY 174
        ( 24.242,  80.575,   5.432, 'C'),  # SER 175
        ( 21.244,  80.187,   3.156, 'E'),  # VAL 176
        ( 20.895,  81.053,  -0.571, 'E'),  # GLN 177
        ( 17.307,  82.101,  -1.341, 'E'),  # LEU 178
        ( 15.694,  81.106,  -4.624, 'E'),  # ALA 179
        ( 12.491,  83.016,  -5.339, 'E'),  # ASP 180
        ( 10.199,  81.086,  -7.712, 'E'),  # HIS 181
        (  7.502,  82.557,  -9.882, 'E'),  # TYR 182
        (  5.483,  80.059, -11.774, 'E'),  # GLN 183
        (  2.646,  79.821, -14.296, 'E'),  # GLN 184
        (  0.840,  76.732, -15.526, 'E'),  # ASN 185
        ( -1.606,  76.717, -18.471, 'E'),  # THR 186
        ( -3.337,  73.690, -20.076, 'E'),  # PRO 187
        ( -2.081,  72.408, -23.423, 'C'),  # ILE 188
        ( -5.496,  70.995, -24.223, 'C'),  # GLY 189
        ( -8.893,  72.274, -25.265, 'C'),  # ASP 190
        (-10.962,  70.776, -22.434, 'C'),  # GLY 191
        (-12.075,  72.283, -19.127, 'C'),  # PRO 192
        ( -9.570,  72.313, -16.290, 'C'),  # VAL 193
        (-10.142,  72.641, -12.501, 'C'),  # LEU 194
        ( -9.279,  76.162, -11.368, 'C'),  # LEU 195
        ( -8.544,  75.952,  -7.622, 'C'),  # PRO 196
        ( -9.288,  77.955,  -4.507, 'C'),  # ASP 197
        ( -6.057,  79.092,  -2.810, 'C'),  # ASN 198
        ( -4.190,  76.226,  -1.153, 'E'),  # HIS 199
        ( -0.630,  74.973,  -0.953, 'E'),  # TYR 200
        (  1.445,  71.870,  -1.443, 'E'),  # LEU 201
        (  3.573,  70.692,   1.425, 'E'),  # SER 202
        (  6.762,  69.364,  -0.191, 'E'),  # THR 203
        (  9.681,  67.367,   1.198, 'E'),  # GLN 204
        ( 12.751,  66.189,  -0.735, 'E'),  # SER 205
        ( 15.844,  64.107,  -0.019, 'E'),  # ALA 206
        ( 18.888,  63.863,  -2.378, 'E'),  # LEU 207
        ( 21.282,  60.937,  -2.550, 'E'),  # SER 208
        ( 23.857,  59.203,  -4.757, 'C'),  # LYS 209
        ( 23.656,  55.709,  -6.145, 'C'),  # ASP 210
        ( 27.049,  54.388,  -5.042, 'C'),  # PRO 211
        ( 27.235,  52.101,  -8.143, 'C'),  # ASN 212
        ( 26.913,  55.024, -10.577, 'C'),  # GLU 213
        ( 29.961,  56.558, -12.197, 'C'),  # LYS 214
        ( 28.109,  59.276, -14.110, 'C'),  # ARG 215
        ( 27.369,  62.604, -12.591, 'C'),  # ASP 216
        ( 23.899,  62.036, -11.204, 'E'),  # HIS 217
        ( 21.225,  62.795,  -8.568, 'E'),  # MET 218
        ( 18.703,  60.474,  -6.950, 'E'),  # VAL 219
        ( 15.621,  62.444,  -5.716, 'E'),  # LEU 220
        ( 12.905,  61.202,  -3.335, 'E'),  # LEU 221
        ( 10.005,  63.557,  -2.781, 'E'),  # GLU 222
        (  6.702,  63.511,  -0.870, 'E'),  # PHE 223
        (  4.030,  66.065,  -1.785, 'E'),  # VAL 224
        (  0.651,  66.633,  -0.183, 'E'),  # THR 225
        ( -1.960,  69.332,  -0.762, 'E'),  # ALA 226
        ( -3.283,  71.356,   2.169, 'E'),  # ALA 227
        ( -4.817,  74.668,   3.205, 'C'),  # GLY 228
        ( -8.556,  74.256,   2.452, 'C'),  # ILE 229
        (-11.129,  73.085,   5.017, 'C'),  # THR 230
    ],
}

# Hemoglobin alpha chain (PDB: 1HHO) - 141 residues
# Oxygen transport in blood - the "breathing protein"
# Nobel Prize: Perutz & Kendrew, 1962
HEMOGLOBIN = {
    'name': 'HEMOGLOBIN',
    'pdb': '1HHO',
    'description': 'Oxygen transport',
    'residues': 141,
    'categories': ['transport', 'disease', 'nobel'],
    'backbone': [
        ( 35.657,  46.671,   2.000, 'C'),  # VAL 1
        ( 34.407,  48.135,   5.423, 'C'),  # LEU 2
        ( 33.493,  51.699,   5.198, 'H'),  # SER 3
        ( 34.169,  54.580,   7.526, 'H'),  # PRO 4
        ( 30.827,  53.670,   9.089, 'H'),  # ALA 5
        ( 31.321,  49.979,   9.301, 'H'),  # ASP 6
        ( 34.536,  50.643,  11.025, 'H'),  # LYS 7
        ( 32.675,  53.090,  13.338, 'H'),  # THR 8
        ( 29.898,  50.516,  14.307, 'H'),  # ASN 9
        ( 32.339,  47.770,  14.698, 'H'),  # VAL 10
        ( 34.523,  50.168,  16.818, 'H'),  # LYS 11
        ( 31.478,  50.528,  18.844, 'H'),  # ALA 12
        ( 29.599,  47.438,  19.348, 'H'),  # ALA 13
        ( 32.941,  46.173,  20.529, 'H'),  # TRP 14
        ( 33.273,  49.171,  22.797, 'H'),  # GLY 15
        ( 30.034,  48.135,  24.384, 'H'),  # LYS 16
        ( 30.958,  44.388,  24.753, 'H'),  # VAL 17
        ( 34.070,  45.234,  26.764, 'H'),  # GLY 18
        ( 35.337,  42.789,  29.341, 'C'),  # ALA 19
        ( 32.884,  40.147,  28.469, 'H'),  # HIS 20
        ( 34.358,  39.695,  25.053, 'H'),  # ALA 21
        ( 35.988,  36.337,  26.073, 'H'),  # GLY 22
        ( 32.816,  35.187,  27.822, 'H'),  # GLU 23
        ( 30.980,  35.739,  24.614, 'H'),  # TYR 24
        ( 33.552,  34.193,  22.640, 'H'),  # GLY 25
        ( 33.295,  31.121,  24.628, 'H'),  # ALA 26
        ( 29.567,  31.106,  24.208, 'H'),  # GLU 27
        ( 29.749,  31.507,  20.413, 'H'),  # ALA 28
        ( 32.004,  28.502,  20.296, 'H'),  # LEU 29
        ( 29.625,  26.432,  22.389, 'H'),  # GLU 30
        ( 26.708,  27.357,  20.110, 'H'),  # ARG 31
        ( 28.652,  26.202,  17.071, 'H'),  # MET 32
        ( 29.749,  22.947,  18.487, 'H'),  # PHE 33
        ( 26.113,  22.462,  19.357, 'H'),  # LEU 34
        ( 24.466,  23.739,  16.150, 'H'),  # SER 35
        ( 26.982,  22.523,  13.651, 'H'),  # PHE 36
        ( 28.322,  19.310,  15.114, 'H'),  # PRO 37
        ( 30.771,  18.813,  12.230, 'H'),  # THR 38
        ( 32.969,  21.537,  13.609, 'H'),  # THR 39
        ( 33.575,  19.324,  16.695, 'H'),  # LYS 40
        ( 36.201,  17.472,  14.564, 'H'),  # THR 41
        ( 38.832,  20.037,  15.095, 'H'),  # TYR 42
        ( 38.622,  19.875,  18.740, 'C'),  # PHE 43
        ( 38.969,  16.258,  19.691, 'C'),  # PRO 44
        ( 41.273,  17.243,  22.645, 'C'),  # HIS 45
        ( 38.714,  19.429,  24.072, 'C'),  # PHE 46
        ( 36.070,  18.731,  26.486, 'C'),  # ASP 47
        ( 33.276,  20.357,  24.428, 'C'),  # LEU 48
        ( 30.892,  20.188,  27.272, 'C'),  # SER 49
        ( 29.117,  23.120,  28.800, 'H'),  # HIS 50
        ( 31.337,  24.345,  31.560, 'H'),  # GLY 51
        ( 34.541,  23.312,  29.798, 'H'),  # SER 52
        ( 37.500,  25.288,  30.775, 'H'),  # ALA 53
        ( 39.225,  24.480,  27.472, 'H'),  # GLN 54
        ( 36.419,  26.094,  25.498, 'H'),  # VAL 55
        ( 36.293,  28.793,  28.109, 'H'),  # LYS 56
        ( 39.825,  29.577,  27.564, 'H'),  # GLY 57
        ( 39.421,  29.244,  23.831, 'H'),  # HIS 58
        ( 36.652,  31.832,  23.701, 'H'),  # GLY 59
        ( 39.265,  34.092,  25.319, 'H'),  # LYS 60
        ( 41.637,  33.474,  22.419, 'H'),  # LYS 61
        ( 39.094,  33.845,  19.649, 'H'),  # VAL 62
        ( 37.831,  37.043,  21.359, 'H'),  # ALA 63
        ( 41.285,  38.491,  21.635, 'H'),  # ASP 64
        ( 42.004,  37.777,  17.985, 'H'),  # ALA 65
        ( 38.827,  39.517,  17.140, 'H'),  # LEU 66
        ( 39.888,  42.612,  19.180, 'H'),  # THR 67
        ( 43.266,  42.602,  17.586, 'H'),  # ASN 68
        ( 41.314,  42.629,  14.272, 'H'),  # ALA 69
        ( 39.071,  45.705,  15.397, 'H'),  # VAL 70
        ( 42.214,  47.534,  16.468, 'H'),  # ALA 71
        ( 44.236,  47.160,  13.235, 'C'),  # HIS 72
        ( 41.071,  46.686,  11.113, 'C'),  # VAL 73
        ( 42.774,  48.772,   8.357, 'C'),  # ASP 74
        ( 45.547,  46.107,   8.516, 'C'),  # ASP 75
        ( 44.146,  42.777,   9.596, 'C'),  # MET 76
        ( 46.207,  40.949,   6.891, 'C'),  # PRO 77
        ( 49.619,  41.662,   8.675, 'C'),  # ASN 78
        ( 48.047,  41.396,  12.074, 'C'),  # ALA 79
        ( 46.253,  38.001,  11.681, 'H'),  # LEU 80
        ( 49.299,  36.974,   9.754, 'H'),  # SER 81
        ( 50.125,  34.012,  11.944, 'H'),  # ALA 82
        ( 46.545,  32.803,  12.642, 'H'),  # LEU 83
        ( 46.155,  32.664,   8.819, 'H'),  # SER 84
        ( 49.038,  30.269,   8.721, 'H'),  # ASP 85
        ( 47.830,  28.284,  11.723, 'H'),  # LEU 86
        ( 44.295,  27.859,  10.517, 'H'),  # HIS 87
        ( 44.853,  27.308,   6.761, 'H'),  # ALA 88
        ( 48.294,  25.665,   6.704, 'C'),  # HIS 89
        ( 48.628,  23.790,   9.807, 'C'),  # LYS 90
        ( 45.001,  23.143,  10.728, 'C'),  # LEU 91
        ( 43.392,  23.046,   7.281, 'C'),  # ARG 92
        ( 40.093,  24.465,   8.517, 'C'),  # VAL 93
        ( 37.254,  24.139,   6.116, 'H'),  # ASP 94
        ( 36.436,  27.642,   5.127, 'H'),  # PRO 95
        ( 32.758,  26.822,   5.547, 'H'),  # VAL 96
        ( 33.602,  26.653,   9.236, 'H'),  # ASN 97
        ( 34.340,  30.323,   9.253, 'H'),  # PHE 98
        ( 30.786,  31.034,   8.144, 'H'),  # LYS 99
        ( 29.210,  28.957,  10.939, 'H'),  # LEU 100
        ( 31.304,  30.508,  13.705, 'H'),  # LEU 101
        ( 30.752,  33.986,  12.395, 'H'),  # SER 102
        ( 27.128,  33.399,  12.607, 'H'),  # HIS 103
        ( 27.307,  32.113,  16.143, 'H'),  # CYS 104
        ( 29.283,  35.231,  17.038, 'H'),  # LEU 105
        ( 26.421,  37.465,  15.671, 'H'),  # LEU 106
        ( 23.656,  35.387,  17.442, 'H'),  # VAL 107
        ( 25.873,  35.845,  20.628, 'H'),  # THR 108
        ( 26.342,  39.718,  20.138, 'H'),  # LEU 109
        ( 22.611,  39.961,  19.411, 'H'),  # ALA 110
        ( 21.640,  37.806,  22.328, 'H'),  # ALA 111
        ( 23.643,  40.125,  24.521, 'H'),  # HIS 112
        ( 23.397,  43.650,  23.147, 'C'),  # LEU 113
        ( 19.924,  44.383,  21.714, 'C'),  # PRO 114
        ( 20.146,  48.167,  21.978, 'C'),  # ALA 115
        ( 23.375,  48.122,  19.995, 'C'),  # GLU 116
        ( 22.606,  45.298,  17.577, 'C'),  # PHE 117
        ( 20.903,  47.548,  15.022, 'H'),  # THR 118
        ( 20.199,  46.215,  11.474, 'H'),  # PRO 119
        ( 23.097,  48.402,  10.413, 'H'),  # ALA 120
        ( 25.449,  47.210,  13.032, 'H'),  # VAL 121
        ( 24.400,  43.685,  12.333, 'H'),  # HIS 122
        ( 25.467,  44.413,   8.769, 'H'),  # ALA 123
        ( 28.857,  46.068,   9.785, 'H'),  # SER 124
        ( 29.550,  43.145,  12.034, 'H'),  # LEU 125
        ( 28.737,  40.563,   9.489, 'H'),  # ASP 126
        ( 31.021,  42.351,   6.963, 'H'),  # LYS 127
        ( 33.688,  42.644,   9.496, 'H'),  # PHE 128
        ( 33.484,  38.996,  10.385, 'H'),  # LEU 129
        ( 33.658,  38.190,   6.806, 'H'),  # ALA 130
        ( 36.911,  40.069,   6.461, 'H'),  # SER 131
        ( 38.484,  38.371,   9.314, 'H'),  # VAL 132
        ( 37.428,  34.976,   7.854, 'H'),  # SER 133
        ( 38.749,  35.912,   4.410, 'H'),  # THR 134
        ( 42.048,  36.775,   5.942, 'H'),  # VAL 135
        ( 42.266,  33.477,   7.959, 'H'),  # LEU 136
        ( 41.516,  31.411,   4.778, 'H'),  # THR 137
        ( 43.726,  33.442,   2.396, 'H'),  # SER 138
        ( 46.581,  31.084,   2.322, 'C'),  # LYS 139
        ( 44.107,  28.758,   0.548, 'C'),  # TYR 140
        ( 43.682,  31.705,  -1.895, 'C'),  # ARG 141
    ],
}

# Cytochrome c (PDB: 1HRC) - 104 residues
# Electron carrier in mitochondria - powers the cell
# Key player in apoptosis (programmed cell death)
CYTOCHROME_C = {
    'name': 'CYTOCHROME C',
    'pdb': '1HRC',
    'description': 'Electron carrier',
    'residues': 104,
    'categories': ['energy', 'ancient', 'apoptosis'],
    'backbone': [
        ( 53.439,  13.215,  -4.519, 'C'),  # GLY 1
        ( 55.283,  15.800,  -6.535, 'H'),  # ASP 2
        ( 56.907,  17.792,  -3.754, 'H'),  # VAL 3
        ( 58.056,  20.536,  -6.199, 'H'),  # GLU 4
        ( 54.710,  20.703,  -7.977, 'H'),  # LYS 5
        ( 53.314,  20.904,  -4.447, 'H'),  # GLY 6
        ( 55.544,  23.886,  -3.523, 'H'),  # LYS 7
        ( 54.256,  25.965,  -6.425, 'H'),  # LYS 8
        ( 50.588,  25.410,  -5.398, 'H'),  # ILE 9
        ( 51.601,  26.428,  -1.894, 'H'),  # PHE 10
        ( 53.314,  29.729,  -2.945, 'H'),  # VAL 11
        ( 50.375,  30.514,  -5.151, 'H'),  # GLN 12
        ( 47.451,  29.679,  -2.940, 'H'),  # LYS 13
        ( 48.477,  29.434,   0.690, 'H'),  # CYS 14
        ( 51.597,  31.589,   1.197, 'C'),  # ALA 15
        ( 49.425,  34.714,   1.581, 'C'),  # GLN 16
        ( 48.170,  33.580,   4.975, 'C'),  # CYS 17
        ( 50.548,  30.868,   6.221, 'C'),  # HIS 18
        ( 54.154,  30.006,   7.101, 'C'),  # THR 19
        ( 55.532,  26.463,   7.190, 'C'),  # VAL 20
        ( 58.963,  26.943,   8.780, 'C'),  # GLU 21
        ( 60.059,  26.341,  12.363, 'C'),  # LYS 22
        ( 59.278,  29.275,  14.588, 'C'),  # GLY 23
        ( 57.902,  31.113,  11.476, 'C'),  # GLY 24
        ( 55.159,  33.689,  12.174, 'C'),  # LYS 25
        ( 51.393,  33.516,  12.271, 'C'),  # HIS 26
        ( 49.965,  35.586,   9.408, 'C'),  # LYS 27
        ( 46.126,  35.836,   8.872, 'C'),  # THR 28
        ( 46.336,  32.022,   9.303, 'C'),  # GLY 29
        ( 48.663,  30.115,  11.593, 'C'),  # PRO 30
        ( 52.223,  28.861,  10.959, 'C'),  # ASN 31
        ( 52.077,  25.221,   9.945, 'C'),  # LEU 32
        ( 55.298,  23.663,  11.297, 'C'),  # HIS 33
        ( 54.351,  20.346,  12.881, 'C'),  # GLY 34
        ( 50.846,  19.874,  11.460, 'C'),  # LEU 35
        ( 50.942,  16.128,  10.662, 'C'),  # PHE 36
        ( 50.002,  13.954,  13.692, 'C'),  # GLY 37
        ( 48.605,  16.888,  15.635, 'C'),  # ARG 38
        ( 44.979,  17.671,  16.362, 'C'),  # LYS 39
        ( 43.115,  20.633,  14.973, 'C'),  # THR 40
        ( 43.639,  24.119,  16.371, 'C'),  # GLY 41
        ( 46.998,  23.395,  18.040, 'C'),  # GLN 42
        ( 49.491,  25.992,  16.808, 'C'),  # ALA 43
        ( 50.630,  27.670,  20.038, 'C'),  # PRO 44
        ( 50.147,  31.418,  19.882, 'C'),  # GLY 45
        ( 47.384,  31.574,  17.258, 'C'),  # PHE 46
        ( 43.753,  32.248,  18.280, 'C'),  # THR 47
        ( 41.576,  29.860,  16.403, 'C'),  # TYR 48
        ( 37.830,  29.767,  15.991, 'H'),  # THR 49
        ( 36.190,  27.301,  18.462, 'H'),  # ASP 50
        ( 35.097,  25.275,  15.402, 'H'),  # ALA 51
        ( 38.719,  24.743,  14.458, 'H'),  # ASN 52
        ( 39.808,  24.042,  17.996, 'H'),  # LYS 53
        ( 36.985,  21.545,  18.626, 'H'),  # ASN 54
        ( 36.957,  19.685,  15.234, 'H'),  # LYS 55
        ( 38.864,  17.060,  17.072, 'C'),  # GLY 56
        ( 40.484,  14.954,  14.349, 'C'),  # ILE 57
        ( 44.255,  14.335,  13.693, 'C'),  # THR 58
        ( 45.831,  15.830,  10.606, 'C'),  # TRP 59
        ( 47.159,  13.206,   8.178, 'H'),  # LYS 60
        ( 46.980,  12.867,   4.351, 'H'),  # GLU 61
        ( 43.419,  11.667,   4.541, 'H'),  # GLU 62
        ( 41.927,  14.370,   6.735, 'H'),  # THR 63
        ( 43.876,  16.997,   4.747, 'H'),  # LEU 64
        ( 42.640,  15.546,   1.446, 'H'),  # MET 65
        ( 38.913,  16.010,   2.413, 'H'),  # GLU 66
        ( 39.479,  19.395,   4.093, 'H'),  # TYR 67
        ( 41.447,  21.028,   1.299, 'H'),  # LEU 68
        ( 38.665,  20.198,  -1.101, 'C'),  # GLU 69
        ( 36.162,  22.303,   0.833, 'H'),  # ASN 70
        ( 37.483,  23.863,   4.047, 'H'),  # PRO 71
        ( 34.187,  25.451,   5.187, 'H'),  # LYS 72
        ( 32.375,  22.171,   4.666, 'H'),  # LYS 73
        ( 34.815,  20.321,   6.918, 'H'),  # TYR 74
        ( 35.188,  23.120,   9.532, 'H'),  # ILE 75
        ( 31.882,  24.967,   9.686, 'C'),  # PRO 76
        ( 32.494,  28.382,  11.088, 'C'),  # GLY 77
        ( 36.206,  28.333,  10.137, 'C'),  # THR 78
        ( 37.674,  31.788,   9.570, 'C'),  # LYS 79
        ( 39.888,  30.393,   6.747, 'C'),  # MET 80
        ( 38.189,  31.860,   3.592, 'C'),  # ILE 81
        ( 39.548,  29.816,   0.714, 'C'),  # PHE 82
        ( 37.488,  27.974,  -1.884, 'C'),  # ALA 83
        ( 39.505,  24.709,  -1.862, 'C'),  # GLY 84
        ( 41.456,  22.695,  -4.469, 'C'),  # ILE 85
        ( 39.047,  20.932,  -6.869, 'C'),  # LYS 86
        ( 41.450,  18.439,  -8.529, 'H'),  # LYS 87
        ( 42.665,  15.405,  -6.602, 'H'),  # LYS 88
        ( 46.234,  15.433,  -7.942, 'H'),  # THR 89
        ( 46.667,  19.051,  -6.936, 'H'),  # GLU 90
        ( 45.617,  18.186,  -3.388, 'H'),  # ARG 91
        ( 48.016,  15.219,  -3.495, 'H'),  # GLU 92
        ( 50.932,  17.331,  -4.691, 'H'),  # ASP 93
        ( 50.308,  19.977,  -1.999, 'H'),  # LEU 94
        ( 50.136,  17.310,   0.800, 'H'),  # ILE 95
        ( 53.440,  15.767,  -0.302, 'H'),  # ALA 96
        ( 55.043,  19.273,  -0.181, 'H'),  # TYR 97
        ( 53.492,  20.026,   3.230, 'H'),  # LEU 98
        ( 54.653,  16.747,   4.858, 'H'),  # LYS 99
        ( 58.157,  17.614,   3.731, 'H'),  # LYS 100
        ( 58.177,  21.282,   4.682, 'H'),  # ALA 101
        ( 56.087,  21.131,   7.858, 'H'),  # THR 102
        ( 58.273,  18.512,   9.619, 'H'),  # ASN 103
        ( 61.554,  20.093,   8.370, 'H'),  # GLU 104
    ],
}

# Collagen triple helix (PDB: 1BKV) - 22 residues
# The scaffold of life - most abundant protein in mammals
# Forms skin, bones, tendons, cartilage
COLLAGEN = {
    'name': 'COLLAGEN',
    'pdb': '1BKV',
    'description': 'Structural protein',
    'residues': 22,
    'categories': ['structural', 'connective', 'ancient'],
    'backbone': [
        ( 27.162,  13.836,  28.479, 'C'),  # GLY 3
        ( 29.409,  10.806,  29.159, 'C'),  # PRO 4
        ( 31.712,   7.245,  24.282, 'C'),  # GLY 6
        ( 33.244,   3.743,  24.073, 'C'),  # PRO 7
        ( 37.406,   3.165,  19.371, 'C'),  # GLY 9
        ( 38.203,  -0.088,  17.592, 'C'),  # ILE 10
        ( 41.770,  -1.378,  17.708, 'C'),  # THR 11
        ( 44.029,  -0.464,  14.789, 'C'),  # GLY 12
        ( 44.994,  -2.736,  11.905, 'C'),  # ALA 13
        ( 48.114,  -4.876,  11.965, 'C'),  # ARG 14
        ( 51.210,  -3.220,  10.578, 'C'),  # GLY 15
        ( 52.551,  -4.007,   7.110, 'C'),  # LEU 16
        ( 54.733,  -7.111,   6.720, 'C'),  # ALA 17
        ( 58.440,  -6.385,   6.992, 'C'),  # GLY 18
        ( 60.856,  -6.103,   4.020, 'C'),  # PRO 19
        ( 66.000,  -9.986,   4.656, 'C'),  # GLY 21
        ( 69.425,  -9.027,   3.291, 'C'),  # PRO 22
        ( 72.647, -14.267,   1.506, 'C'),  # GLY 24
        ( 76.420, -14.893,   1.773, 'C'),  # PRO 25
        ( 78.330, -19.354,  -2.521, 'C'),  # GLY 27
        ( 80.952, -22.152,  -2.442, 'C'),  # PRO 28
        ( 83.403, -23.862,  -8.253, 'C'),  # GLY 30
    ],
}

# List of all proteins
PROTEINS = [
    UBIQUITIN,
    MYOGLOBIN,
    LYSOZYME,
    INSULIN,
    GFP,
    HEMOGLOBIN,
    CYTOCHROME_C,
    COLLAGEN,
]


class Proteins(Visual):
    name = "PROTEINS"
    description = "3D protein backbone structures"
    category = "science"

    def __init__(self, display: Display):
        super().__init__(display)

    def reset(self):
        self.time = 0.0
        self.protein_idx = 0
        self.rotation_y = 0.0  # Manual: left/right
        self.tilt_x = 0.0      # Manual: up/down
        self.rotation_z = 0.0  # Continuous auto-rotate around Z
        self.auto_rotate_speed = 0.3
        self.auto_cycle = True
        self.cycle_timer = 0.0
        self.cycle_duration = 15.0  # Longer view time for proteins
        self.label_timer = 0.0
        self.scroll_offset = 0.0  # For scrolling long text
        self._prepare_protein()

    def _prepare_protein(self):
        """Pre-compute scale and centering for current protein."""
        protein = PROTEINS[self.protein_idx]
        backbone = protein['backbone']

        if len(backbone) == 0:
            self.scale = 1.0
            self.offset = (0, 0, 0)
            return

        # Center of mass
        cx = sum(r[0] for r in backbone) / len(backbone)
        cy = sum(r[1] for r in backbone) / len(backbone)
        cz = sum(r[2] for r in backbone) / len(backbone)
        self.offset = (cx, cy, cz)

        # Find maximum extent
        max_r = 0.0
        for r in backbone:
            dx, dy, dz = r[0] - cx, r[1] - cy, r[2] - cz
            dist = math.sqrt(dx * dx + dy * dy + dz * dz)
            max_r = max(max_r, dist)

        # Scale to fit display (leave room for labels)
        target_radius = 24.0
        self.scale = target_radius / max_r if max_r > 0 else 1.0
        self.label_timer = 0.0

    def handle_input(self, input_state) -> bool:
        consumed = False
        rotation_speed = 2.0  # Radians per second for manual control
        tilt_speed = 1.5

        # Joystick controls rotation (Y and X axes)
        # Any manual rotation pauses auto-cycle until button press
        if input_state.left:
            self.rotation_y -= rotation_speed * 0.016  # Assume ~60fps
            self.auto_cycle = False  # Pause auto-cycle while exploring
            consumed = True
        if input_state.right:
            self.rotation_y += rotation_speed * 0.016
            self.auto_cycle = False
            consumed = True
        if input_state.up:
            self.tilt_x -= tilt_speed * 0.016
            self.auto_cycle = False
            consumed = True
        if input_state.down:
            self.tilt_x += tilt_speed * 0.016
            self.auto_cycle = False
            consumed = True

        # Action buttons cycle through proteins and resume auto-cycle
        if input_state.action_l:
            self.protein_idx = (self.protein_idx - 1) % len(PROTEINS)
            self.cycle_timer = 0.0
            self.auto_cycle = True  # Resume auto-cycle
            self._prepare_protein()
            consumed = True
        if input_state.action_r:
            self.protein_idx = (self.protein_idx + 1) % len(PROTEINS)
            self.cycle_timer = 0.0
            self.auto_cycle = True  # Resume auto-cycle
            self._prepare_protein()
            consumed = True

        return consumed

    def update(self, dt: float):
        self.time += dt
        self.label_timer += dt
        self.scroll_offset += dt * 20  # Scroll speed in pixels/sec

        # Continuous auto-rotate around Z axis
        self.rotation_z += self.auto_rotate_speed * dt

        if self.auto_cycle:
            self.cycle_timer += dt
            if self.cycle_timer >= self.cycle_duration:
                self.cycle_timer = 0.0
                self.protein_idx = (self.protein_idx + 1) % len(PROTEINS)
                self._prepare_protein()

    def _transform_point(self, x, y, z):
        """Apply rotation and project to screen coords."""
        # Center
        x -= self.offset[0]
        y -= self.offset[1]
        z -= self.offset[2]

        # Scale
        x *= self.scale
        y *= self.scale
        z *= self.scale

        # Auto-rotation around Z axis (constant tumble)
        cos_z, sin_z = math.cos(self.rotation_z), math.sin(self.rotation_z)
        x1 = x * cos_z - y * sin_z
        y1 = x * sin_z + y * cos_z

        # Manual tilt (rotation around X axis) - controlled by up/down
        cos_t, sin_t = math.cos(self.tilt_x), math.sin(self.tilt_x)
        y2 = y1 * cos_t - z * sin_t
        z2 = y1 * sin_t + z * cos_t

        # Manual rotation around Y axis - controlled by left/right
        cos_r, sin_r = math.cos(self.rotation_y), math.sin(self.rotation_y)
        x2 = x1 * cos_r + z2 * sin_r
        z3 = -x1 * sin_r + z2 * cos_r

        # Orthographic projection
        screen_x = GRID_SIZE // 2 + x2
        screen_y = 28 - y2  # Slight offset from center for label room

        return screen_x, screen_y, z3

    def draw(self):
        self.display.clear(Colors.BLACK)

        protein = PROTEINS[self.protein_idx]
        backbone = protein['backbone']

        if len(backbone) < 2:
            return

        # Transform all backbone points
        transformed = []
        for x, y, z, ss in backbone:
            sx, sy, sz = self._transform_point(x, y, z)
            transformed.append((sx, sy, sz, ss))

        # Build draw list: segments between consecutive residues
        # We'll draw back-to-front for proper occlusion
        segments = []
        for i in range(len(transformed) - 1):
            x1, y1, z1, ss1 = transformed[i]
            x2, y2, z2, ss2 = transformed[i + 1]
            avg_z = (z1 + z2) / 2
            # Use the secondary structure of the first residue for color
            segments.append((avg_z, x1, y1, x2, y2, ss1, i))

        # Sort by z (back to front)
        segments.sort(key=lambda s: s[0])

        # Draw backbone segments
        for seg in segments:
            _, x1, y1, x2, y2, ss, idx = seg
            color = SS_COLORS.get(ss, SS_COLORS['C'])

            # Apply depth shading
            avg_z = seg[0]
            depth_factor = 0.5 + 0.5 * (avg_z / 30.0 + 0.5)
            depth_factor = max(0.3, min(1.0, depth_factor))

            shaded = (
                int(color[0] * depth_factor),
                int(color[1] * depth_factor),
                int(color[2] * depth_factor),
            )

            # Draw thicker line for helices and sheets
            self._draw_backbone_segment(x1, y1, x2, y2, shaded, ss)

        # Draw small dots at Cα positions for structure
        for i, (sx, sy, sz, ss) in enumerate(transformed):
            color = SS_COLORS.get(ss, SS_COLORS['C'])
            depth_factor = 0.5 + 0.5 * (sz / 30.0 + 0.5)
            depth_factor = max(0.3, min(1.0, depth_factor))
            dot_color = (
                int(color[0] * depth_factor),
                int(color[1] * depth_factor),
                int(color[2] * depth_factor),
            )
            # Just the center pixel for Cα
            ix, iy = int(round(sx)), int(round(sy))
            if 0 <= ix < GRID_SIZE and 0 <= iy < GRID_SIZE:
                self.display.set_pixel(ix, iy, dot_color)

        # Draw label at bottom - cycle through name, description, PDB ID
        cycle = int(self.label_timer / 6) % 3
        if cycle == 0:
            label = protein['name']
        elif cycle == 1:
            label = protein['description']
        else:
            label = f"PDB: {protein['pdb']}"

        # Reset scroll when label changes
        if not hasattr(self, '_last_cycle') or self._last_cycle != cycle:
            self._last_cycle = cycle
            self.scroll_offset = 0

        # Scroll long text (4px per char, ~14 chars fit on screen)
        max_chars = 14
        if len(label) > max_chars:
            # Add padding for smooth loop
            padded = label + "    " + label
            char_width = 4
            total_width = len(label + "    ") * char_width
            offset = int(self.scroll_offset) % total_width
            self.display.draw_text_small(2 - offset, 58, padded, Colors.WHITE)
        else:
            self.display.draw_text_small(2, 58, label, Colors.WHITE)

    def _draw_backbone_segment(self, x1, y1, x2, y2, color, ss):
        """Draw a backbone segment with thickness based on secondary structure."""
        ix1, iy1 = int(round(x1)), int(round(y1))
        ix2, iy2 = int(round(x2)), int(round(y2))

        # Draw main line
        self.display.draw_line(ix1, iy1, ix2, iy2, color)

        # For helices and sheets, draw thicker (offset lines)
        if ss in ('H', 'G', 'I', 'E', 'B'):
            # Calculate perpendicular offset for thickness
            dx = x2 - x1
            dy = y2 - y1
            length = math.sqrt(dx * dx + dy * dy)
            if length > 0:
                # Perpendicular unit vector
                px = -dy / length
                py = dx / length

                # Draw parallel lines for thickness
                dimmed = (color[0] // 2, color[1] // 2, color[2] // 2)
                self.display.draw_line(
                    int(round(x1 + px)), int(round(y1 + py)),
                    int(round(x2 + px)), int(round(y2 + py)),
                    dimmed
                )
                self.display.draw_line(
                    int(round(x1 - px)), int(round(y1 - py)),
                    int(round(x2 - px)), int(round(y2 - py)),
                    dimmed
                )
